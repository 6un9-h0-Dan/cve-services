FROM node:14-alpine3.12

LABEL \
    mitre.name=cveawg \
    mitre.project=cveawg \
    mitre.maintainer=mbianchi@mitre.org

WORKDIR /app

# copy into development container only what we need to have
# defined before running the application
COPY config /app/config
COPY docker/entrypoint.sh /app/entrypoint.sh

# Change db hostname from localhost to docdb for use inside docker
COPY docker/default.json-docker /app/config/default.json

# we'll copy in the package.json, but mount the package-lock.json, so
# we can update the package-lock.json file without installing npm or node locally

# we'll copy `package.json` for an initial build, but we'll mount it in
# our `docker/docker-compose.yml` so we can update it from inside the container
COPY package.json /app

RUN npm install
RUN echo '{}' > /app/config/development.json
RUN echo '{}' > /app/config/integration.json
RUN echo '{}' > /app/config/production.json
RUN echo '{}' > /app/config/test.json

EXPOSE 3000
ENTRYPOINT '/app/entrypoint.sh'
