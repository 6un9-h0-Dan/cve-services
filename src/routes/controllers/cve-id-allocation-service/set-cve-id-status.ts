import { dbOperations } from '../../../database/db-operations';

export const setCveIdStatus = async (req, res) => {
    const { ids, status } = req.body;
    const statusRegex = /^(Free|Rejected|Disputed|Populated|Public|Published|Reserved|Obsolete)$/g;
    try {
        if (status) {
            if (!new RegExp(statusRegex).test(status)) {
                res.status(400).json({ error: 'Invalid Status' });
                return;
            }
        }
        var result = [];
        for (let i = 0; i < ids.length; i++) {
            try {
                let response = await dbOperations.editCveStatus(ids[i], status, req.userOrgUUID);
                result.push(response);
            } catch (err) {
                res.status(400).json({ error: 'Something happened!' });
            }
        }
        res.status(200).json({ Success: result.length + ' Ids have been updated' });
    } catch (err) {
        console.log(err);
        res.status(400).json({ error: 'Something happened!' });
    }
};
