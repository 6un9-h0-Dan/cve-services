const Org = require('../model/org')
const User = require('../model/user')
const CONSTANTS = require('../constants')

async function isSecretariat (shortName) {
  const org = await Org.findOne().byShortName(shortName)
  const secretariats = await Org.find({ 'authority.active_roles': { $in: [CONSTANTS.AUTH_ROLE_ENUM.SECRETARIAT] } })

  secretariats.forEach((obj) => {
    if (obj.UUID === org.UUID) {
      return true
    }
  })

  return false
}

async function getOrgUUID (shortName) {
  const org = await Org.findOne().byShortName(shortName)

  return org.UUID
}

async function getUserUUID (username, shortName) {
  const org = await Org.findOne().byShortName(shortName)
  const user = await User.findOne().byUserNameAndOrgUUID(username, org.UUID)

  return user.UUID
}

module.exports = {
  isSecretariat,
  getOrgUUID,
  getUserUUID
}
