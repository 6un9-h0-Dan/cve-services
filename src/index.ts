import "reflect-metadata";
import * as express from "express";
import * as bodyParser from "body-parser";
import { configureRoutes } from "./routes";
import * as dotenv from "dotenv";
import * as logger from "morgan";
import * as cors from "cors";
import * as helmet from "helmet";
import { verifyRequester } from "./middlewares/verification";
import { ERROR_MESSAGE } from "./constants";
const app = express();
const configed = dotenv.config();

//*********Middleware Config*********** */
app.use(cors()); //adding Cross-origin resource sharing.
if (process.env.NODE_ENV === "dev") app.use(logger("dev")); //creates logs

app.use(helmet()); //gives standard security
app.use(bodyParser.json()); //parses incoming json
app.use(verifyRequester); //This is where we would verify Users trying to request access/data
//*********Middleware Config END*********** */

//*********API Routes Setup*********** */
configureRoutes(app); //configure app routes

// start express server
app.listen(process.env.PORT);

app.use(function(err, req, res, next) {
  res.status(500).send({ error: ERROR_MESSAGE[500] });
});

console.log("Express server has started on port: ", process.env.PORT);
