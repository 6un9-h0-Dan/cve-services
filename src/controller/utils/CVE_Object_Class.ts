import { CVE_STATUS, DEFAULT_CVE_STATUS } from "../../constants";
import * as uuidv4 from "uuid/v4";

export class CVE_Object {
  public year: any;
  public status: string;
  public req: any;
  public CVE_ID_OBJECT = {
    cve_id: "",
    status: "",
    Requestor: { user_id: "", user_name: "" },
    Organization: { org_id: "", org_name: "" },
    History: "TBD"
  };

  constructor(req: any, year?: string, status: string = DEFAULT_CVE_STATUS) {
    if (!year) year = new Date().getFullYear().toString();

    console.log(status);

    if (!CVE_STATUS[status]) throw new Error("Incorrect Use of Status");

    this.year = year;
    this.status = CVE_STATUS[status];
    this.req = req;
  }

  public createCVEID() {
    this.CVE_ID_OBJECT.cve_id = "CVE-" + this.year + "-" + uuidv4();
    this.CVE_ID_OBJECT.status = this.status;
    this.CVE_ID_OBJECT.Requestor.user_id = this.req.userData.userUUID;
    this.CVE_ID_OBJECT.Requestor.user_name =
      this.req.userData.userFName + " " + this.req.userData.userLName;
    this.CVE_ID_OBJECT.Organization.org_id = this.req.userData.userCNAUUID;
    this.CVE_ID_OBJECT.Organization.org_name = this.req.userData.userCNAName;
    return this.CVE_ID_OBJECT;
  }
}
