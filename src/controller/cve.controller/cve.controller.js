const middleware = require('../../middleware/middleware')
const cve_repository = require('../../repository/cve.repository')

async function cveSubmission(req, res) {
    // Check API secret to make sure it's valid and avoid open requests
    let cna = req.header('CVE-API-CNA')
    // let author = req.header('CVE-API-AUTHOR')
    // let secret = req.header('CVE-API-SECRET')
    // let error = middleware.validApiSecret(cna, author, secret)
    // if (error) {
    //     return error
    // }
    // // TODO: implement any additional steps needed to make sure it's safe to parse the JSON
    // // Validate CVE JSON against JSON schema to avoid bad data
    // error = middleware.validCveJSON(req.body)
    // if (error) {
    //     return error
    // }
    let cve = req.body
    // // Make sure Author specified in header matches the JSON before passing to CPS
    // if (cve.author != author) {
    //     return // Return an error that indicates the CVE cannot be submitted
    // }
    // Pass CVE submission to CVE controller and therefore CPS
    cve_repository.submitCve(cna, cve)
    res.send("NEW-CVE-SUBMITTED")
}

module.exports = {
    CVE_SUBMISSION: cveSubmission
}