const mongoose = require('mongoose')
const CONSTANTS = require('../constants')


const OrgSchema = new mongoose.Schema({
  _id: false,
  name: String,
  short_name: String,
  UUID: String,
  authority: {
    active_roles: [String]
  },
  policies: {
    id_quota: { 
      type: Number, 
      min: [CONSTANTS.MONGOOSE_VALIDATION.Org_policies_id_quota_min, CONSTANTS.MONGOOSE_VALIDATION.Org_policies_id_quota_min_message], 
      max: [CONSTANTS.MONGOOSE_VALIDATION.Org_policies_id_quota_max, CONSTANTS.MONGOOSE_VALIDATION.Org_policies_id_quota_max_message]
    }
  },
  time: {
    created: Date,
    modified: Date
  }
}, { collection: 'Org', timestamps: { createdAt: 'time.created', updatedAt: 'time.modified' } })

OrgSchema.query.byShortName = function (shortName) {
  return this.where({ short_name: new RegExp('^' + shortName + '$', 'i') }) // match shortName exactly (case insensitive)
}

OrgSchema.query.byUUID = function (uuid) {
  return this.where({ UUID: new RegExp('^' + uuid + '$') }) // match UUID exactly
}

const Org = mongoose.model('Org', OrgSchema)
module.exports = Org
